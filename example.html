<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8">
		<title>Observe_evented demo</title>
		
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
		<script src="https://louisameline.github.io/observe_evented/src/observe_evented.js"></script>
		
		<style type='text/css'>
			.blue {
				color: blue;
			}

			.green {
				color: green;
			}

			.red {
				color: red;
			}
		</style>
		
		<script type='text/javascript'>
			
			$(function(){
				
				if(!Object.observe){
					alert('Your browser does not support Object.observe, this demo cannot work !');
				}

				var basket1 = { vegetable: 'carrot' },
					basket2 = ['apple'],
					options = {
						// uncomment anytime to test
						//dropValues: true,
						//eventTypes: ['add', 'update', 'remove'],
						//minimalEvents: true
					};

				// replace basket1 by basket2 in this line to test on an array instead of an object
				$.observe(basket1, options)
					.on('add', function(event){
						show('<span class="green">Added</span> : ' + propOrIndex(event.object) + ' <b>' +
							 event.name + '</b>, value <b>' + event.value + '</b>'
						);
					})
					.on('update', function(event){
					   show('<span class="blue">Updated</span> : ' + propOrIndex(event.object) + ' <b>' + event.name + 
							'</b>, ' + 'value went from <b>' + event.oldValue + '</b> to <b>' + event.value + '</b>'
					   );
					})
					.on('remove', function(event){
						show('<span class="red">Removed</span> : ' + propOrIndex(event.object) + ' <b>' + event.name +
							 '</b>, former value was <b>' + event.oldValue + '</b>'
						);
					})
					.on('add update remove', function(event){
						// uncomment to see the regular events
						//logEvent(event);
					})
					.on('batch rawBatch', function(event){
						// uncomment to see the special batch and rawBatch events
						//logEvent(event);
					});


				// object changes
				basket1.fruit = 'apple';
				basket1.fruit = 'strawberry';
				basket1.vegetable = 'pea';
				basket1.meat = 'chicken';
				delete basket1.meat;

				// array changes
				basket2[0] = 'peach';
				basket2.push('pear');
				basket2.unshift('banana', 'cherry');
				// delete should be avoided on arrays, it's only for the example
				delete basket2[0];
				basket2.splice(0, 2, 'strawberry', 'grape');
				basket2.push('watermellon', 'mango');




				// UTILS

				function show(val){
					$('#main').append('<div>' + val + '</div>');
				}
				function logEvent(val){
					// hide jQuery properties
					var eventProps = ['type', 'object', 'name', 'value', 'oldValue'];
					$.each(val, function(prop, v){
						if($.inArray(prop, eventProps) === -1){
							delete val[prop];
						}
					});
					$('#main').append('<pre>' + JSON.stringify(val,null,2) + '</pre>');
				}
				function propOrIndex(obj){
					return $.isArray(obj) ? 'at index' : 'property';
				}
				
			});
			
		</script>
	</head>
	<body>
		<p>This example will be hosted on jsFiddle at <a href="http://jsfiddle.net/d9w3uaav/">this address</a>.</p>
		<p>Check the source code of this page to see what happens backstage.</p>
		<div id="main"></div>
	</body>
</html>